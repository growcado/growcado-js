{"version":3,"file":"utils.js","names":["_debug","_interopRequireDefault","require","_lodash","e","__esModule","default","debug","buildDebug","MODULE_NOT_FOUND","isValid","plugin","_","isFunction","isES6","Object","keys","includes","tryLoad","path","onError","err","code","message","replace","split","slice","msg"],"sources":["../src/utils.ts"],"sourcesContent":["import buildDebug from 'debug';\nimport _ from 'lodash';\n\nimport { pluginUtils } from '@verdaccio/core';\n\nconst debug = buildDebug('verdaccio:plugin:loader:utils');\nconst MODULE_NOT_FOUND = 'MODULE_NOT_FOUND';\n\nexport type PluginType<T> = T extends pluginUtils.Plugin<T> ? T : never;\n\nexport function isValid<T>(plugin: PluginType<T>): boolean {\n  // @ts-expect-error default not relevant\n  return _.isFunction(plugin) || _.isFunction(plugin.default);\n}\n\nexport function isES6<T>(plugin: PluginType<T>): boolean {\n  return Object.keys(plugin).includes('default');\n}\n\n/**\n * Requires a module.\n * @param {*} path the module's path\n * @return {Object}\n */\nexport function tryLoad<T>(path: string, onError: any): PluginType<T> | null {\n  try {\n    debug('loading plugin %s', path);\n    return require(path) as PluginType<T>;\n  } catch (err: any) {\n    if (err.code === MODULE_NOT_FOUND) {\n      debug('\"require\" failed for plugin %s', path);\n      // If loading fails, because a dependency is missing,\n      // we want to log the error message and require stack\n      // to see where the missing dependency is.\n      const message = err.message.replace(/\\\\\\\\/g, '\\\\').split('\\n');\n      if (!message[0].includes(path)) {\n        debug('%o', message[0]); // error message\n        debug('%o', message.slice(1)); // stack trace\n      }\n      return null;\n    }\n    onError({ err: err.msg }, 'error loading plugin @{err}');\n    throw err;\n  }\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAF,sBAAA,CAAAC,OAAA;AAAuB,SAAAD,uBAAAG,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAIvB,MAAMG,KAAK,GAAG,IAAAC,cAAU,EAAC,+BAA+B,CAAC;AACzD,MAAMC,gBAAgB,GAAG,kBAAkB;AAIpC,SAASC,OAAOA,CAAIC,MAAqB,EAAW;EACzD;EACA,OAAOC,eAAC,CAACC,UAAU,CAACF,MAAM,CAAC,IAAIC,eAAC,CAACC,UAAU,CAACF,MAAM,CAACL,OAAO,CAAC;AAC7D;AAEO,SAASQ,KAAKA,CAAIH,MAAqB,EAAW;EACvD,OAAOI,MAAM,CAACC,IAAI,CAACL,MAAM,CAAC,CAACM,QAAQ,CAAC,SAAS,CAAC;AAChD;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASC,OAAOA,CAAIC,IAAY,EAAEC,OAAY,EAAwB;EAC3E,IAAI;IACFb,KAAK,CAAC,mBAAmB,EAAEY,IAAI,CAAC;IAChC,OAAOjB,OAAO,CAACiB,IAAI,CAAC;EACtB,CAAC,CAAC,OAAOE,GAAQ,EAAE;IACjB,IAAIA,GAAG,CAACC,IAAI,KAAKb,gBAAgB,EAAE;MACjCF,KAAK,CAAC,gCAAgC,EAAEY,IAAI,CAAC;MAC7C;MACA;MACA;MACA,MAAMI,OAAO,GAAGF,GAAG,CAACE,OAAO,CAACC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,CAACC,KAAK,CAAC,IAAI,CAAC;MAC9D,IAAI,CAACF,OAAO,CAAC,CAAC,CAAC,CAACN,QAAQ,CAACE,IAAI,CAAC,EAAE;QAC9BZ,KAAK,CAAC,IAAI,EAAEgB,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACzBhB,KAAK,CAAC,IAAI,EAAEgB,OAAO,CAACG,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACjC;MACA,OAAO,IAAI;IACb;IACAN,OAAO,CAAC;MAAEC,GAAG,EAAEA,GAAG,CAACM;IAAI,CAAC,EAAE,6BAA6B,CAAC;IACxD,MAAMN,GAAG;EACX;AACF","ignoreList":[]}