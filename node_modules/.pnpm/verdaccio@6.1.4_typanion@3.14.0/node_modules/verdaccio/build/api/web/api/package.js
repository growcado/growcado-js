"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _express = require("express");
var _lodash = _interopRequireDefault(require("lodash"));
var _config = require("@verdaccio/config");
var _middleware = require("@verdaccio/middleware");
var _tarball = require("@verdaccio/tarball");
var _utils = require("@verdaccio/utils");
var _constants = require("../../../lib/constants");
var _logger = require("../../../lib/logger");
var _utils2 = require("../../../lib/utils");
var _utils3 = require("./utils");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
const getOrder = (order = 'asc') => {
  return order === 'asc';
};
function addPackageWebApi(storage, auth, config) {
  /* eslint new-cap:off */
  const pkgRouter = (0, _express.Router)();
  const can = (0, _middleware.allow)(auth, {
    beforeAll: (params, message) => {
      _logger.logger.debug(params, message);
    },
    afterAll: (params, message) => _logger.logger.debug(params, message)
  });
  const checkAllow = (name, remoteUser) => new Promise((resolve, reject) => {
    try {
      var _config$web, _config$web2;
      const isLoginEnabled = _lodash.default.isNil(config === null || config === void 0 ? void 0 : (_config$web = config.web) === null || _config$web === void 0 ? void 0 : _config$web.login) || (config === null || config === void 0 ? void 0 : (_config$web2 = config.web) === null || _config$web2 === void 0 ? void 0 : _config$web2.login) === true;
      const anonymousRemoteUser = (0, _config.createAnonymousRemoteUser)();
      const remoteUserAccess = !isLoginEnabled ? anonymousRemoteUser : remoteUser;
      auth.allow_access({
        packageName: name
      }, remoteUserAccess, (err, allowed) => {
        if (err) {
          resolve(false);
        }
        resolve(allowed);
      });
    } catch (err) {
      reject(err);
    }
  });

  // Get list of all visible package
  pkgRouter.get((0, _utils3.wrapPath)(_middleware.WebUrls.packages_all), function (req, res, next) {
    storage.getLocalDatabase(async function (err, packages) {
      if (err) {
        throw err;
      }
      async function processPackages(packages = []) {
        const permissions = [];
        const packgesCopy = packages.slice();
        for (const pkg of packgesCopy) {
          const pkgCopy = _objectSpread({}, pkg);
          pkgCopy.author = (0, _utils.formatAuthor)(pkg.author);
          try {
            const isAllowed = await checkAllow(pkg.name, req.remote_user);
            if (isAllowed) {
              if (config.web) {
                pkgCopy.author.avatar = (0, _utils.generateGravatarUrl)(pkgCopy.author.email, config.web.gravatar);
              }
              if (!_lodash.default.isNil(pkgCopy.dist) && !_lodash.default.isNull(pkgCopy.dist.tarball)) {
                pkgCopy.dist.tarball = (0, _tarball.getLocalRegistryTarballUri)(pkgCopy.dist.tarball, pkg.name, {
                  protocol: req.protocol,
                  headers: req.headers,
                  host: req.hostname
                }, config.url_prefix);
              }
              permissions.push(pkgCopy);
            }
          } catch (err) {
            _logger.logger.error({
              name: pkg.name,
              error: err
            }, 'permission process for @{name} has failed: @{error}');
            throw err;
          }
        }
        return permissions;
      }
      const {
        web
      } = config;
      // @ts-ignore
      const order = config.web ? getOrder(web.sort_packages) : true;
      try {
        next((0, _utils2.sortByName)(await processPackages(packages), order));
      } catch (error) {
        next(_utils2.ErrorCode.getInternalError());
      }
    });
  });

  // Get package readme
  pkgRouter.get([(0, _utils3.wrapPath)(_middleware.WebUrls.readme_package_scoped_version), (0, _utils3.wrapPath)(_middleware.WebUrls.readme_package_version)], can('access'), function (req, res, next) {
    const rawScope = req.params.scope; // May include '@'
    const scope = rawScope ? rawScope.slice(1) : null; // Remove '@' if present
    const packageName = scope ? (0, _utils2.addScope)(scope, req.params.package) : req.params.package;
    storage.getPackage({
      name: packageName,
      uplinksLook: true,
      req,
      callback: function (err, info) {
        if (err) {
          return next(err);
        }
        res.set(_constants.HEADER_TYPE.CONTENT_TYPE, _constants.HEADERS.TEXT_PLAIN);
        next((0, _utils2.parseReadme)(info.name, info.readme));
      }
    });
  });
  pkgRouter.get([(0, _utils3.wrapPath)(_middleware.WebUrls.sidebar_scopped_package), (0, _utils3.wrapPath)(_middleware.WebUrls.sidebar_package)], can('access'), function (req, res, next) {
    const rawScope = req.params.scope; // May include '@'
    const scope = rawScope ? rawScope.slice(1) : null; // Remove '@' if present
    const packageName = scope ? (0, _utils2.addScope)(scope, req.params.package) : req.params.package;
    storage.getPackage({
      name: packageName,
      uplinksLook: true,
      keepUpLinkData: true,
      req,
      callback: function (err, info) {
        if (_lodash.default.isNil(err)) {
          const {
            v
          } = req.query;
          let sideBarInfo = _lodash.default.clone(info);
          sideBarInfo.versions = (0, _tarball.convertDistRemoteToLocalTarballUrls)(info, {
            protocol: req.protocol,
            headers: req.headers,
            host: req.hostname
          }, config.url_prefix).versions;
          if ((0, _utils2.isVersionValid)(info, v)) {
            // @ts-ignore
            sideBarInfo.latest = sideBarInfo.versions[v];
            sideBarInfo.latest.author = (0, _utils.formatAuthor)(sideBarInfo.latest.author);
          } else {
            var _sideBarInfo;
            sideBarInfo.latest = sideBarInfo.versions[info[_constants.DIST_TAGS].latest];
            if ((_sideBarInfo = sideBarInfo) !== null && _sideBarInfo !== void 0 && _sideBarInfo.latest) {
              sideBarInfo.latest.author = (0, _utils.formatAuthor)(sideBarInfo.latest.author);
            } else {
              res.status(_constants.HTTP_STATUS.NOT_FOUND);
              res.end();
              return;
            }
          }
          sideBarInfo = (0, _utils2.deleteProperties)(['readme', '_attachments', '_rev', 'name'], sideBarInfo);
          if (config.web) {
            sideBarInfo = (0, _utils.addGravatarSupport)(sideBarInfo, config.web.gravatar);
          } else {
            sideBarInfo = (0, _utils.addGravatarSupport)(sideBarInfo);
          }
          next(sideBarInfo);
        } else {
          res.status(_constants.HTTP_STATUS.NOT_FOUND);
          res.end();
        }
      }
    });
  });
  return pkgRouter;
}
var _default = exports.default = addPackageWebApi;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsInJlcXVpcmUiLCJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9jb25maWciLCJfbWlkZGxld2FyZSIsIl90YXJiYWxsIiwiX3V0aWxzIiwiX2NvbnN0YW50cyIsIl9sb2dnZXIiLCJfdXRpbHMyIiwiX3V0aWxzMyIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIm93bktleXMiLCJyIiwidCIsIk9iamVjdCIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJkZWZpbmVQcm9wZXJ0eSIsIl90b1Byb3BlcnR5S2V5IiwidmFsdWUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImkiLCJfdG9QcmltaXRpdmUiLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsImNhbGwiLCJUeXBlRXJyb3IiLCJTdHJpbmciLCJOdW1iZXIiLCJnZXRPcmRlciIsIm9yZGVyIiwiYWRkUGFja2FnZVdlYkFwaSIsInN0b3JhZ2UiLCJhdXRoIiwiY29uZmlnIiwicGtnUm91dGVyIiwiUm91dGVyIiwiY2FuIiwiYWxsb3ciLCJiZWZvcmVBbGwiLCJwYXJhbXMiLCJtZXNzYWdlIiwibG9nZ2VyIiwiZGVidWciLCJhZnRlckFsbCIsImNoZWNrQWxsb3ciLCJuYW1lIiwicmVtb3RlVXNlciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiX2NvbmZpZyR3ZWIiLCJfY29uZmlnJHdlYjIiLCJpc0xvZ2luRW5hYmxlZCIsIl8iLCJpc05pbCIsIndlYiIsImxvZ2luIiwiYW5vbnltb3VzUmVtb3RlVXNlciIsImNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIiLCJyZW1vdGVVc2VyQWNjZXNzIiwiYWxsb3dfYWNjZXNzIiwicGFja2FnZU5hbWUiLCJlcnIiLCJhbGxvd2VkIiwiZ2V0Iiwid3JhcFBhdGgiLCJXZWJVcmxzIiwicGFja2FnZXNfYWxsIiwicmVxIiwicmVzIiwibmV4dCIsImdldExvY2FsRGF0YWJhc2UiLCJwYWNrYWdlcyIsInByb2Nlc3NQYWNrYWdlcyIsInBlcm1pc3Npb25zIiwicGFja2dlc0NvcHkiLCJzbGljZSIsInBrZyIsInBrZ0NvcHkiLCJhdXRob3IiLCJmb3JtYXRBdXRob3IiLCJpc0FsbG93ZWQiLCJyZW1vdGVfdXNlciIsImF2YXRhciIsImdlbmVyYXRlR3JhdmF0YXJVcmwiLCJlbWFpbCIsImdyYXZhdGFyIiwiZGlzdCIsImlzTnVsbCIsInRhcmJhbGwiLCJnZXRMb2NhbFJlZ2lzdHJ5VGFyYmFsbFVyaSIsInByb3RvY29sIiwiaGVhZGVycyIsImhvc3QiLCJob3N0bmFtZSIsInVybF9wcmVmaXgiLCJlcnJvciIsInNvcnRfcGFja2FnZXMiLCJzb3J0QnlOYW1lIiwiRXJyb3JDb2RlIiwiZ2V0SW50ZXJuYWxFcnJvciIsInJlYWRtZV9wYWNrYWdlX3Njb3BlZF92ZXJzaW9uIiwicmVhZG1lX3BhY2thZ2VfdmVyc2lvbiIsInJhd1Njb3BlIiwic2NvcGUiLCJhZGRTY29wZSIsInBhY2thZ2UiLCJnZXRQYWNrYWdlIiwidXBsaW5rc0xvb2siLCJjYWxsYmFjayIsImluZm8iLCJzZXQiLCJIRUFERVJfVFlQRSIsIkNPTlRFTlRfVFlQRSIsIkhFQURFUlMiLCJURVhUX1BMQUlOIiwicGFyc2VSZWFkbWUiLCJyZWFkbWUiLCJzaWRlYmFyX3Njb3BwZWRfcGFja2FnZSIsInNpZGViYXJfcGFja2FnZSIsImtlZXBVcExpbmtEYXRhIiwidiIsInF1ZXJ5Iiwic2lkZUJhckluZm8iLCJjbG9uZSIsInZlcnNpb25zIiwiY29udmVydERpc3RSZW1vdGVUb0xvY2FsVGFyYmFsbFVybHMiLCJpc1ZlcnNpb25WYWxpZCIsImxhdGVzdCIsIl9zaWRlQmFySW5mbyIsIkRJU1RfVEFHUyIsInN0YXR1cyIsIkhUVFBfU1RBVFVTIiwiTk9UX0ZPVU5EIiwiZW5kIiwiZGVsZXRlUHJvcGVydGllcyIsImFkZEdyYXZhdGFyU3VwcG9ydCIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcGkvd2ViL2FwaS9wYWNrYWdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IHsgY3JlYXRlQW5vbnltb3VzUmVtb3RlVXNlciB9IGZyb20gJ0B2ZXJkYWNjaW8vY29uZmlnJztcbmltcG9ydCB7IFdlYlVybHMsIGFsbG93IH0gZnJvbSAnQHZlcmRhY2Npby9taWRkbGV3YXJlJztcbmltcG9ydCB7XG4gIGNvbnZlcnREaXN0UmVtb3RlVG9Mb2NhbFRhcmJhbGxVcmxzLFxuICBnZXRMb2NhbFJlZ2lzdHJ5VGFyYmFsbFVyaSxcbn0gZnJvbSAnQHZlcmRhY2Npby90YXJiYWxsJztcbmltcG9ydCB7IENvbmZpZywgTWFuaWZlc3QsIFJlbW90ZVVzZXIgfSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcbmltcG9ydCB7IGFkZEdyYXZhdGFyU3VwcG9ydCwgZm9ybWF0QXV0aG9yLCBnZW5lcmF0ZUdyYXZhdGFyVXJsIH0gZnJvbSAnQHZlcmRhY2Npby91dGlscyc7XG5cbmltcG9ydCBBdXRoIGZyb20gJy4uLy4uLy4uL2xpYi9hdXRoJztcbmltcG9ydCB7IERJU1RfVEFHUywgSEVBREVSUywgSEVBREVSX1RZUEUsIEhUVFBfU1RBVFVTIH0gZnJvbSAnLi4vLi4vLi4vbGliL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi8uLi8uLi9saWIvbG9nZ2VyJztcbmltcG9ydCBTdG9yYWdlIGZyb20gJy4uLy4uLy4uL2xpYi9zdG9yYWdlJztcbmltcG9ydCB7XG4gIEVycm9yQ29kZSxcbiAgYWRkU2NvcGUsXG4gIGRlbGV0ZVByb3BlcnRpZXMsXG4gIGlzVmVyc2lvblZhbGlkLFxuICBwYXJzZVJlYWRtZSxcbiAgc29ydEJ5TmFtZSxcbn0gZnJvbSAnLi4vLi4vLi4vbGliL3V0aWxzJztcbmltcG9ydCB7ICROZXh0RnVuY3Rpb25WZXIsICRSZXF1ZXN0RXh0ZW5kLCAkUmVzcG9uc2VFeHRlbmQsICRTaWRlYmFyUGFja2FnZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzJztcbmltcG9ydCB7IHdyYXBQYXRoIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IGdldE9yZGVyID0gKG9yZGVyID0gJ2FzYycpID0+IHtcbiAgcmV0dXJuIG9yZGVyID09PSAnYXNjJztcbn07XG5cbmV4cG9ydCB0eXBlIFBhY2tjYWdlRXh0ID0gTWFuaWZlc3QgJiB7IGF1dGhvcjogYW55OyBkaXN0PzogeyB0YXJiYWxsOiBzdHJpbmcgfSB9O1xuXG5mdW5jdGlvbiBhZGRQYWNrYWdlV2ViQXBpKHN0b3JhZ2U6IFN0b3JhZ2UsIGF1dGg6IEF1dGgsIGNvbmZpZzogQ29uZmlnKTogUm91dGVyIHtcbiAgLyogZXNsaW50IG5ldy1jYXA6b2ZmICovXG4gIGNvbnN0IHBrZ1JvdXRlciA9IFJvdXRlcigpO1xuICBjb25zdCBjYW4gPSBhbGxvdyhhdXRoLCB7XG4gICAgYmVmb3JlQWxsOiAocGFyYW1zLCBtZXNzYWdlKSA9PiB7XG4gICAgICBsb2dnZXIuZGVidWcocGFyYW1zLCBtZXNzYWdlKTtcbiAgICB9LFxuICAgIGFmdGVyQWxsOiAocGFyYW1zLCBtZXNzYWdlKSA9PiBsb2dnZXIuZGVidWcocGFyYW1zLCBtZXNzYWdlKSxcbiAgfSk7XG5cbiAgY29uc3QgY2hlY2tBbGxvdyA9IChuYW1lLCByZW1vdGVVc2VyKTogUHJvbWlzZTxib29sZWFuPiA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpOiB2b2lkID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGlzTG9naW5FbmFibGVkID0gXy5pc05pbChjb25maWc/LndlYj8ubG9naW4pIHx8IGNvbmZpZz8ud2ViPy5sb2dpbiA9PT0gdHJ1ZTtcbiAgICAgICAgY29uc3QgYW5vbnltb3VzUmVtb3RlVXNlcjogUmVtb3RlVXNlciA9IGNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIoKTtcbiAgICAgICAgY29uc3QgcmVtb3RlVXNlckFjY2VzcyA9ICFpc0xvZ2luRW5hYmxlZCA/IGFub255bW91c1JlbW90ZVVzZXIgOiByZW1vdGVVc2VyO1xuICAgICAgICBhdXRoLmFsbG93X2FjY2Vzcyh7IHBhY2thZ2VOYW1lOiBuYW1lIH0sIHJlbW90ZVVzZXJBY2Nlc3MsIChlcnIsIGFsbG93ZWQpOiB2b2lkID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzb2x2ZShhbGxvd2VkIGFzIGJvb2xlYW4pO1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAvLyBHZXQgbGlzdCBvZiBhbGwgdmlzaWJsZSBwYWNrYWdlXG4gIHBrZ1JvdXRlci5nZXQoXG4gICAgd3JhcFBhdGgoV2ViVXJscy5wYWNrYWdlc19hbGwpLFxuICAgIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgICAgc3RvcmFnZS5nZXRMb2NhbERhdGFiYXNlKGFzeW5jIGZ1bmN0aW9uIChlcnIsIHBhY2thZ2VzKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cblxuICAgICAgICBhc3luYyBmdW5jdGlvbiBwcm9jZXNzUGFja2FnZXMocGFja2FnZXM6IFBhY2tjYWdlRXh0W10gPSBbXSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgICAgY29uc3QgcGVybWlzc2lvbnM6IFBhY2tjYWdlRXh0W10gPSBbXTtcbiAgICAgICAgICBjb25zdCBwYWNrZ2VzQ29weSA9IHBhY2thZ2VzLnNsaWNlKCk7XG4gICAgICAgICAgZm9yIChjb25zdCBwa2cgb2YgcGFja2dlc0NvcHkpIHtcbiAgICAgICAgICAgIGNvbnN0IHBrZ0NvcHkgPSB7IC4uLnBrZyB9O1xuICAgICAgICAgICAgcGtnQ29weS5hdXRob3IgPSBmb3JtYXRBdXRob3IocGtnLmF1dGhvcik7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zdCBpc0FsbG93ZWQgPSBhd2FpdCBjaGVja0FsbG93KHBrZy5uYW1lLCByZXEucmVtb3RlX3VzZXIpO1xuICAgICAgICAgICAgICBpZiAoaXNBbGxvd2VkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy53ZWIpIHtcbiAgICAgICAgICAgICAgICAgIHBrZ0NvcHkuYXV0aG9yLmF2YXRhciA9IGdlbmVyYXRlR3JhdmF0YXJVcmwoXG4gICAgICAgICAgICAgICAgICAgIHBrZ0NvcHkuYXV0aG9yLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICBjb25maWcud2ViLmdyYXZhdGFyXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIV8uaXNOaWwocGtnQ29weS5kaXN0KSAmJiAhXy5pc051bGwocGtnQ29weS5kaXN0LnRhcmJhbGwpKSB7XG4gICAgICAgICAgICAgICAgICBwa2dDb3B5LmRpc3QudGFyYmFsbCA9IGdldExvY2FsUmVnaXN0cnlUYXJiYWxsVXJpKFxuICAgICAgICAgICAgICAgICAgICBwa2dDb3B5LmRpc3QudGFyYmFsbCxcbiAgICAgICAgICAgICAgICAgICAgcGtnLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHsgcHJvdG9jb2w6IHJlcS5wcm90b2NvbCwgaGVhZGVyczogcmVxLmhlYWRlcnMgYXMgYW55LCBob3N0OiByZXEuaG9zdG5hbWUgfSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnVybF9wcmVmaXhcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zLnB1c2gocGtnQ29weSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICAgICAgeyBuYW1lOiBwa2cubmFtZSwgZXJyb3I6IGVyciB9LFxuICAgICAgICAgICAgICAgICdwZXJtaXNzaW9uIHByb2Nlc3MgZm9yIEB7bmFtZX0gaGFzIGZhaWxlZDogQHtlcnJvcn0nXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gcGVybWlzc2lvbnM7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IHdlYiB9ID0gY29uZmlnO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IG9yZGVyOiBib29sZWFuID0gY29uZmlnLndlYiA/IGdldE9yZGVyKHdlYi5zb3J0X3BhY2thZ2VzKSA6IHRydWU7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBuZXh0KHNvcnRCeU5hbWUoYXdhaXQgcHJvY2Vzc1BhY2thZ2VzKHBhY2thZ2VzKSwgb3JkZXIpKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBuZXh0KEVycm9yQ29kZS5nZXRJbnRlcm5hbEVycm9yKCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICk7XG5cbiAgLy8gR2V0IHBhY2thZ2UgcmVhZG1lXG4gIHBrZ1JvdXRlci5nZXQoXG4gICAgW3dyYXBQYXRoKFdlYlVybHMucmVhZG1lX3BhY2thZ2Vfc2NvcGVkX3ZlcnNpb24pLCB3cmFwUGF0aChXZWJVcmxzLnJlYWRtZV9wYWNrYWdlX3ZlcnNpb24pXSxcbiAgICBjYW4oJ2FjY2VzcycpLFxuICAgIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgICAgY29uc3QgcmF3U2NvcGUgPSByZXEucGFyYW1zLnNjb3BlOyAvLyBNYXkgaW5jbHVkZSAnQCdcbiAgICAgIGNvbnN0IHNjb3BlID0gcmF3U2NvcGUgPyByYXdTY29wZS5zbGljZSgxKSA6IG51bGw7IC8vIFJlbW92ZSAnQCcgaWYgcHJlc2VudFxuICAgICAgY29uc3QgcGFja2FnZU5hbWUgPSBzY29wZSA/IGFkZFNjb3BlKHNjb3BlLCByZXEucGFyYW1zLnBhY2thZ2UpIDogcmVxLnBhcmFtcy5wYWNrYWdlO1xuXG4gICAgICBzdG9yYWdlLmdldFBhY2thZ2Uoe1xuICAgICAgICBuYW1lOiBwYWNrYWdlTmFtZSxcbiAgICAgICAgdXBsaW5rc0xvb2s6IHRydWUsXG4gICAgICAgIHJlcSxcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChlcnIsIGluZm8pOiB2b2lkIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV4dChlcnIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlcy5zZXQoSEVBREVSX1RZUEUuQ09OVEVOVF9UWVBFLCBIRUFERVJTLlRFWFRfUExBSU4pO1xuICAgICAgICAgIG5leHQocGFyc2VSZWFkbWUoaW5mby5uYW1lLCBpbmZvLnJlYWRtZSkpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICApO1xuXG4gIHBrZ1JvdXRlci5nZXQoXG4gICAgW3dyYXBQYXRoKFdlYlVybHMuc2lkZWJhcl9zY29wcGVkX3BhY2thZ2UpLCB3cmFwUGF0aChXZWJVcmxzLnNpZGViYXJfcGFja2FnZSldLFxuICAgIGNhbignYWNjZXNzJyksXG4gICAgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICBjb25zdCByYXdTY29wZSA9IHJlcS5wYXJhbXMuc2NvcGU7IC8vIE1heSBpbmNsdWRlICdAJ1xuICAgICAgY29uc3Qgc2NvcGUgPSByYXdTY29wZSA/IHJhd1Njb3BlLnNsaWNlKDEpIDogbnVsbDsgLy8gUmVtb3ZlICdAJyBpZiBwcmVzZW50XG4gICAgICBjb25zdCBwYWNrYWdlTmFtZTogc3RyaW5nID0gc2NvcGUgPyBhZGRTY29wZShzY29wZSwgcmVxLnBhcmFtcy5wYWNrYWdlKSA6IHJlcS5wYXJhbXMucGFja2FnZTtcblxuICAgICAgc3RvcmFnZS5nZXRQYWNrYWdlKHtcbiAgICAgICAgbmFtZTogcGFja2FnZU5hbWUsXG4gICAgICAgIHVwbGlua3NMb29rOiB0cnVlLFxuICAgICAgICBrZWVwVXBMaW5rRGF0YTogdHJ1ZSxcbiAgICAgICAgcmVxLFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKGVycjogRXJyb3IsIGluZm86ICRTaWRlYmFyUGFja2FnZSk6IHZvaWQge1xuICAgICAgICAgIGlmIChfLmlzTmlsKGVycikpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgdiB9ID0gcmVxLnF1ZXJ5O1xuICAgICAgICAgICAgbGV0IHNpZGVCYXJJbmZvOiBhbnkgPSBfLmNsb25lKGluZm8pO1xuICAgICAgICAgICAgc2lkZUJhckluZm8udmVyc2lvbnMgPSBjb252ZXJ0RGlzdFJlbW90ZVRvTG9jYWxUYXJiYWxsVXJscyhcbiAgICAgICAgICAgICAgaW5mbyxcbiAgICAgICAgICAgICAgeyBwcm90b2NvbDogcmVxLnByb3RvY29sLCBoZWFkZXJzOiByZXEuaGVhZGVycyBhcyBhbnksIGhvc3Q6IHJlcS5ob3N0bmFtZSB9LFxuICAgICAgICAgICAgICBjb25maWcudXJsX3ByZWZpeFxuICAgICAgICAgICAgKS52ZXJzaW9ucztcbiAgICAgICAgICAgIGlmIChpc1ZlcnNpb25WYWxpZChpbmZvLCB2KSkge1xuICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgIHNpZGVCYXJJbmZvLmxhdGVzdCA9IHNpZGVCYXJJbmZvLnZlcnNpb25zW3ZdO1xuICAgICAgICAgICAgICBzaWRlQmFySW5mby5sYXRlc3QuYXV0aG9yID0gZm9ybWF0QXV0aG9yKHNpZGVCYXJJbmZvLmxhdGVzdC5hdXRob3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2lkZUJhckluZm8ubGF0ZXN0ID0gc2lkZUJhckluZm8udmVyc2lvbnNbaW5mb1tESVNUX1RBR1NdLmxhdGVzdF07XG4gICAgICAgICAgICAgIGlmIChzaWRlQmFySW5mbz8ubGF0ZXN0KSB7XG4gICAgICAgICAgICAgICAgc2lkZUJhckluZm8ubGF0ZXN0LmF1dGhvciA9IGZvcm1hdEF1dGhvcihzaWRlQmFySW5mby5sYXRlc3QuYXV0aG9yKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk5PVF9GT1VORCk7XG4gICAgICAgICAgICAgICAgcmVzLmVuZCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2lkZUJhckluZm8gPSBkZWxldGVQcm9wZXJ0aWVzKFsncmVhZG1lJywgJ19hdHRhY2htZW50cycsICdfcmV2JywgJ25hbWUnXSwgc2lkZUJhckluZm8pO1xuICAgICAgICAgICAgaWYgKGNvbmZpZy53ZWIpIHtcbiAgICAgICAgICAgICAgc2lkZUJhckluZm8gPSBhZGRHcmF2YXRhclN1cHBvcnQoc2lkZUJhckluZm8sIGNvbmZpZy53ZWIuZ3JhdmF0YXIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2lkZUJhckluZm8gPSBhZGRHcmF2YXRhclN1cHBvcnQoc2lkZUJhckluZm8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV4dChzaWRlQmFySW5mbyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKTtcbiAgICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gICk7XG5cbiAgcmV0dXJuIHBrZ1JvdXRlcjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYWRkUGFja2FnZVdlYkFwaTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsUUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBRUEsSUFBQUcsT0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksV0FBQSxHQUFBSixPQUFBO0FBQ0EsSUFBQUssUUFBQSxHQUFBTCxPQUFBO0FBS0EsSUFBQU0sTUFBQSxHQUFBTixPQUFBO0FBR0EsSUFBQU8sVUFBQSxHQUFBUCxPQUFBO0FBQ0EsSUFBQVEsT0FBQSxHQUFBUixPQUFBO0FBRUEsSUFBQVMsT0FBQSxHQUFBVCxPQUFBO0FBU0EsSUFBQVUsT0FBQSxHQUFBVixPQUFBO0FBQW1DLFNBQUFFLHVCQUFBUyxDQUFBLFdBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUsT0FBQSxFQUFBRixDQUFBO0FBQUEsU0FBQUcsUUFBQUgsQ0FBQSxFQUFBSSxDQUFBLFFBQUFDLENBQUEsR0FBQUMsTUFBQSxDQUFBQyxJQUFBLENBQUFQLENBQUEsT0FBQU0sTUFBQSxDQUFBRSxxQkFBQSxRQUFBQyxDQUFBLEdBQUFILE1BQUEsQ0FBQUUscUJBQUEsQ0FBQVIsQ0FBQSxHQUFBSSxDQUFBLEtBQUFLLENBQUEsR0FBQUEsQ0FBQSxDQUFBQyxNQUFBLFdBQUFOLENBQUEsV0FBQUUsTUFBQSxDQUFBSyx3QkFBQSxDQUFBWCxDQUFBLEVBQUFJLENBQUEsRUFBQVEsVUFBQSxPQUFB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