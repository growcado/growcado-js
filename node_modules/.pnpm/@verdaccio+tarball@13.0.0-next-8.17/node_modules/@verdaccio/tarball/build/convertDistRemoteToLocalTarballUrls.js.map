{"version":3,"file":"convertDistRemoteToLocalTarballUrls.js","names":["_getLocalRegistryTarballUri","require","convertDistRemoteToLocalTarballUrls","pkg","request","urlPrefix","name","versions","convertedPkg","convertedVersions","ver","Object","prototype","hasOwnProperty","call","version","convertDistVersionToLocalTarballsUrl","distName","dist","tarball","getLocalRegistryTarballUri"],"sources":["../src/convertDistRemoteToLocalTarballUrls.ts"],"sourcesContent":["import { Manifest, Version } from '@verdaccio/types';\nimport { RequestOptions } from '@verdaccio/url';\n\nimport { getLocalRegistryTarballUri } from './getLocalRegistryTarballUri';\n\n/**\n * Iterate a packages's versions and filter each original tarball url.\n * @param {*} pkg\n * @param {*} request\n * @param {*} urlPrefix\n * @return {String} a filtered package\n */\nexport function convertDistRemoteToLocalTarballUrls(\n  pkg: Manifest,\n  request: RequestOptions,\n  urlPrefix: string | void\n): Manifest {\n  const { name, versions } = pkg;\n  const convertedPkg = { ...pkg };\n  const convertedVersions = versions;\n  for (const ver in pkg.versions) {\n    if (Object.prototype.hasOwnProperty.call(pkg.versions, ver)) {\n      const version = versions[ver];\n      convertedVersions[ver] = convertDistVersionToLocalTarballsUrl(\n        name,\n        version,\n        request,\n        urlPrefix\n      );\n    }\n  }\n\n  return {\n    ...convertedPkg,\n    versions: convertedVersions,\n  };\n}\n\n/**\n * Convert single Version disst tarball\n * @param name\n * @param version\n * @param request\n * @param urlPrefix\n * @returns\n */\nexport function convertDistVersionToLocalTarballsUrl(\n  name: string,\n  version: Version,\n  request: RequestOptions,\n  urlPrefix: string | void\n) {\n  const distName = version.dist;\n\n  if (distName && distName.tarball) {\n    return {\n      ...version,\n      dist: {\n        ...distName,\n        tarball: getLocalRegistryTarballUri(distName.tarball, name, request, urlPrefix),\n      },\n    };\n  }\n\n  return version;\n}\n"],"mappings":";;;;;;;AAGA,IAAAA,2BAAA,GAAAC,OAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,mCAAmCA,CACjDC,GAAa,EACbC,OAAuB,EACvBC,SAAwB,EACd;EACV,MAAM;IAAEC,IAAI;IAAEC;EAAS,CAAC,GAAGJ,GAAG;EAC9B,MAAMK,YAAY,GAAG;IAAE,GAAGL;EAAI,CAAC;EAC/B,MAAMM,iBAAiB,GAAGF,QAAQ;EAClC,KAAK,MAAMG,GAAG,IAAIP,GAAG,CAACI,QAAQ,EAAE;IAC9B,IAAII,MAAM,CAACC,SAAS,CAACC,cAAc,CAACC,IAAI,CAACX,GAAG,CAACI,QAAQ,EAAEG,GAAG,CAAC,EAAE;MAC3D,MAAMK,OAAO,GAAGR,QAAQ,CAACG,GAAG,CAAC;MAC7BD,iBAAiB,CAACC,GAAG,CAAC,GAAGM,oCAAoC,CAC3DV,IAAI,EACJS,OAAO,EACPX,OAAO,EACPC,SACF,CAAC;IACH;EACF;EAEA,OAAO;IACL,GAAGG,YAAY;IACfD,QAAQ,EAAEE;EACZ,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASO,oCAAoCA,CAClDV,IAAY,EACZS,OAAgB,EAChBX,OAAuB,EACvBC,SAAwB,EACxB;EACA,MAAMY,QAAQ,GAAGF,OAAO,CAACG,IAAI;EAE7B,IAAID,QAAQ,IAAIA,QAAQ,CAACE,OAAO,EAAE;IAChC,OAAO;MACL,GAAGJ,OAAO;MACVG,IAAI,EAAE;QACJ,GAAGD,QAAQ;QACXE,OAAO,EAAE,IAAAC,sDAA0B,EAACH,QAAQ,CAACE,OAAO,EAAEb,IAAI,EAAEF,OAAO,EAAEC,SAAS;MAChF;IACF,CAAC;EACH;EAEA,OAAOU,OAAO;AAChB","ignoreList":[]}